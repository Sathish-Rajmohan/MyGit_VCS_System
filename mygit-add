#!/usr/bin/env python3

# mygit-add - Adds files to the index
# Creates a new index entry for the specified files
# Usage: mygit-add <filenames>
# where <filenames> is a list of files to add to the index

import os
import sys
import shutil

def main():
    if len(sys.argv) < 2:
        print(f"usage: {os.path.basename(sys.argv[0])} <filenames>", file=sys.stderr)
        sys.exit(1)
    
    if not os.path.exists('.mygit'):
        print(f"{os.path.basename(sys.argv[0])}: error: mygit repository directory .mygit not found", file=sys.stderr)
        sys.exit(1)
    
    filenames = sys.argv[1:]
    
    for filename in filenames:
        # Special handling: if file doesn't exist, remove it from index if it's there
        if not os.path.exists(filename):
            index_file = os.path.join('.mygit', 'index', filename)
            if os.path.exists(index_file):
                # File was deleted from working directory, remove from index too
                os.remove(index_file)
                continue
            else:
                print(f"{os.path.basename(sys.argv[0])}: error: can not open '{filename}'", file=sys.stderr)
                sys.exit(1)
        
        if not os.path.isfile(filename):
            print(f"{os.path.basename(sys.argv[0])}: error: '{filename}' is not a regular file", file=sys.stderr)
            sys.exit(1)
        
        # Copy file to index
        index_path = os.path.join('.mygit', 'index', filename)
        try:
            shutil.copy2(filename, index_path)
        except OSError as e:
            print(f"{os.path.basename(sys.argv[0])}: error: {e}", file=sys.stderr)
            sys.exit(1)

if __name__ == '__main__':
    main()